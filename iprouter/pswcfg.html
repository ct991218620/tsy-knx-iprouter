<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>TSY KNX IP Router</title>

<!-- Bootstrap -->
<link href="css/bootstrap.min.css" rel="stylesheet">
<style>
.center {
	margin: 0 auto;
	width: 1000px;
}
.lipadding {
	padding-left: 20px;
}
</style>
</head>

<body>
  <nav class="navbar-dark bg-dark" >
    <div class="center">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark" > <a class="navbar-brand"  href="#">TSY KNX IP Router</a>
        <div class="collapse navbar-collapse" id="navbarSupportedContent" >
          <ul class="navbar-nav mr-auto">
            <li class="nav-item lipadding" > <a class="nav-link" href="status.html">状态总览</a> </li>
            <li class="nav-item lipadding" > <a class="nav-link" href="update.html">固件升级</a> </li>
            <li class="nav-item lipadding" > <a class="nav-link" href="pswcfg.html">密码设置</a> </li>
          </ul>
        </div>
      <ul class="navbar-nav mr-auto">
      <li class="nav-item lipadding"> <a class="nav-link" id="sysrestart" href="#">重启</a> </li>
      <li class="nav-item lipadding"> <a class="nav-link" id="out" href="index.html">退出</a> </li>
      </ul>  
      </nav>
    </div>
  </nav>
<div class="center">
<div class="card card-primary card-outline" style="margin-top: 15px">
  <div class="card-header">
    <h5 class="card-title"> <i class="fas fa-edit"></i> 系统密码设置 </h5>
  </div>
  <div class="card-body">
    <div class="row">
      <div class="col-2"  style="margin-top:10px">原登录密码</div>
      <input  type="password" id="inputPassword1" class="form-control col-3" aria-describedby="passwordHelpInline">
      <p class="invalid-feedback col"> </p>
      <div class="w-100 d-none d-md-block" style="margin-top:10px"></div>
      <div class="col-2" style="margin-top:10px">新登录密码</div>
      <input  type="password" id="inputPassword2" class="form-control col-3" aria-describedby="passwordHelpInline">
      <div class="w-100 d-none d-md-block"  style="margin-top:10px"></div>
      <div class="col-2"  style="margin-top:10px">确认新登录密码</div>
      <input  type="password" id="inputPassword3" class="form-control col-3" aria-describedby="passwordHelpInline">
      <p id="invaltxt" class="invalid-feedback col"  style="margin-top:10px"> </p>
    </div>
  </div>
  <div class="modal fade" id="exampleModal3" tabindex="-1"  data-backdrop="static" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-sm">
      <div class="modal-content" id="saveok">
        <div class="modal-body" style="text-align:center;margin-top:10;padding-top:10">
          <h5 >保存成功，重启后生效</h5>
        </div>
        <div class="modal-body" style="text-align:center;margin:0;padding: 0">
          <h5 >是否立即重启</h5>
        </div>
        <div style="text-align: center">
          <button type="button" class="btn btn-secondary" style="margin:10px" data-dismiss="modal">稍后重启</button>
          <button type="button" class="btn btn-primary" id="restart" style="margin:10px" >立即重启</button>
        </div>
      </div>
      <div  id="saveing" class="modal-content" style="display: none">
        <div  class="modal-body" style="text-align:center;margin-top:10;padding-top:10">
          <h5 style="padding-top: 10px">正在保存</h5>
          <div class="spinner-border ml-auto" role="status" aria-hidden="true"></div>
        </div>
      </div>
	<div class="modal-content" id="saveerror">
        <div class="modal-body" style="text-align:center;margin-top:10;padding-top:10">
          <h5 >原密码错误，请重新输入</h5>
        </div>
        <div style="text-align: center">
          <button type="button" class="btn btn-primary" style="margin:10px" data-dismiss="modal">确定</button>
        </div>
      </div>
    </div>
  </div>
	 <div class="modal fade" id="exampleModal5"  data-backdrop="static" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-sm">
        <div class="modal-content" >
          <div class="modal-body" style="text-align:center;margin-top:10;padding-top:10">
            <h5>重启系统，请确认</h5>
          </div>
          <div style="text-align: center">
            <button type="button" class="btn btn-secondary" style="margin:10px" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-primary" id="restart2" style="margin:10px" >确定</button>
          </div>
        </div>
      </div>
    </div>
  <div class="card-footer" style="height: 50px;padding:5px;margin-top: 15px">
    <button type="button" id="save" class="btn btn-primary float-right active" style="margin-right: 10px">确认保存</button>
  </div>
  <!-- /container -->
  </div>

    <hr style="border:none;border-top:1px solid #ADABAB;">
    <a href="">Powered by Tesiyun Electronics / Copyright (c) 2020 Tesiyun Electronics All rights reserved</a>

</div>
</body>
<script src="js/jquery.bootstrap.cookie.js"></script> 
<script>
	
	function savetodev(){
		var jqdata={};
	   for (var i = 1; i < 3; i++) {
		  jqdata["password"+i] = $('#inputPassword'+i).val();
	   }
		$('#exampleModal3').modal('show');
	    $('#saveok').hide();
		$('#saveerror').hide();
		$('#saveing').show();

		console.log(jqdata);
	   $.post("/cgi-bin/savepsw",jqdata,function(data){
			console.log(data);
		    var ret = JSON.parse(data);
			if(ret.status==1){
				$('#saveerror').hide();
				$('#saveing').hide();
				$('#saveok').show();
				console.log(data);	
			}else{
				$('#saveing').hide();
				$('#saveok').hide();
                $('#saveerror').show();
				$("#inputPassword1").val('');
			}		
		});
	}
    $('#save').click(function(){
		 for (var i = 1; i < 4; i++) {
		   	if($("#inputPassword"+i).val()=='')
			{
				$("#invaltxt").html('');
				$('#inputPassword'+i).addClass("is-invalid");
				break;
			}else {
                $('#inputPassword'+i).removeClass("is-invalid");
			}
	   }
	   if(i>=4)
	   {   
		   if($('#inputPassword2').val()== $('#inputPassword3').val()){
			   console.log("savetodev");
			   savetodev();
		   }else {
			   	$("#invaltxt").html('');
			  	$("#invaltxt").append('密码输入不一致');
			    $('#inputPassword3').addClass("is-invalid"); 
		   }
	   }  
	});  //群组地址模态框确认按键
	$('#inputPassword3,#inputPassword2').on('input propertychange',function(){
		if($('#inputPassword3').val()!=''){
			console.log("psw1!=psw2");
			if($('#inputPassword3').val()!=$('#inputPassword2').val()){
			 	$("#invaltxt").html('');
			  	$("#invaltxt").append('密码输入不一致');
			    $('#inputPassword3').addClass("is-invalid");	   
		   }else{
			   	$("#invaltxt").html('');
			    $('#inputPassword3').removeClass("is-invalid");
		   }
		}
	});
	$('#restart,#restart2').click(function(){
	        window.location.href="restart.html";
	});  
	$('#sysrestart').click(function(){
		$('#exampleModal5').modal('show');
	});  
	
</script>
</html>
